version: 1.0
component: deployment
env:
  variables:
    version: ${APP_VERSION}

files:
  - source: /
    destination: /tmp/

steps:
  - stepType: Command
    name: Setup ENV
    command: |
       # Stop NGINX if it exists
       sudo systemctl stop nginx || true
       sudo systemctl disable nginx || true

       # Install and start Apache
       sudo dnf install httpd -y
       sudo systemctl enable httpd --now

       # Open firewall port 80
       sudo firewall-cmd --permanent --zone=public --add-service=http
       sudo firewall-cmd --reload
    timeoutInSeconds: 600

  - stepType: Command
    name: Install Apache Web Server
    command: |
      hname=$(hostname)
      bg_color="GREEN"
      if [[ $hname == blue* ]]; then
          bg_color="BLUE"
      fi
      sudo truncate -s 0 /var/www/html/index.html
      sudo chmod 766 /var/www/html/index.html
      echo "<body><b>With Love from OCI Devops(Version:${APP_VERSION}) ,Served via environment:<font color=$bg_color>$bg_color</font></body>" > /var/www/html/index.html
    timeoutInSeconds: 600
